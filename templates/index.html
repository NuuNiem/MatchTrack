{% extends 'base.html' %}

{% block content %}
  <h2>Ottelut</h2>

  <form method="get" action="{{ url_for('matches') }}">
    <label for="q">Haku</label>
    <input type="text" id="q" name="q" placeholder="Hae otsikolla tai kuvauksella" value="{{ q }}">
    <button type="submit">Hae</button>
    {% if q %}<a href="{{ url_for('matches') }}">Tyhjennä</a>{% endif %}
  </form>

  {% if matches %}
    <ul style="list-style: none; padding: 0;">
      {% for match in matches %}
        <li class="match-card">
          <strong><a href="{{ url_for('match_detail', match_id=match.id) }}">{{ match.title }}</a></strong>
          {% if match.date %}<div><small>{{ match.date }}</small></div>{% endif %}
          {% if match.opponent %}<div><small>Vastustaja: {{ match.opponent }}</small></div>{% endif %}
          {% if match.result %}<div><small>Tulos: {{ match.result }}</small></div>{% endif %}
          {% if match.location %}<div><small>{{ match.location }}</small></div>{% endif %}
          <div style="white-space: pre-wrap;">{{ match.description }}</div>
          {% if match.categories %}
            <small>Kategoriat: {{ match.categories }}</small>
          {% endif %}
          <small>Omistaja: <a href="{{ url_for('user_profile', user_id=match.owner_id) }}">{{ match.username }}</a></small>
          {% if session.get('user_id') and session.get('user_id') == match.owner_id %}
            <div>
              <a href="{{ url_for('edit_match', match_id=match.id) }}">Muokkaa</a>
              <form action="{{ url_for('delete_match', match_id=match.id) }}" method="post" style="display:inline">
                <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}">
                <button type="submit" onclick="return confirm('Poistetaanko?')">Poista</button>
              </form>
            </div>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>Ei otteluita.</p>
  {% endif %}

  {% if total_pages > 1 %}
    <div style="margin-top: 2rem; text-align: center;">
      {% if page > 1 %}
        <a href="{{ url_for('matches', page=page-1, q=q) }}">« Edellinen</a>
      {% endif %}
      
      <span style="margin: 0 1rem;">Sivu {{ page }} / {{ total_pages }}</span>
      
      {% if page < total_pages %}
        <a href="{{ url_for('matches', page=page+1, q=q) }}">Seuraava »</a>
      {% endif %}
    </div>
  {% endif %}

{% endblock %}
